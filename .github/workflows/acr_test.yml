---
name: Build and Push Image to AWS ECR
on:
  pull_request_target:
    branches: [ "PW-main" ]
    types: [ "closed" ]
jobs:
  build-and-push:
    if: github.event.pull_request.merged == true
    name: 'Docker build and push to acr'
    runs-on: ubuntu:latest

    defaults:
      run:
        shell: bash
    steps:
    # Checkout the repository to the GitHub Actions runner
    - name: Checkout
      uses: actions/checkout@v4
    # login to docker
    - name: 'Docker Login'
      uses: azure/docker-login@v1
      with:
        login-server: ${{ secrets.ACR_REGISTRY_LOGIN_SERVER_PW }}
        username: ${{ secrets.ACR_REGISTRY_USERNAME_PW }}
        password: ${{ secrets.ACR_REGISTRY_PASSWORD_PW }}
     
     - name: Build the frontend image and push it to ACR
      uses: docker/build-push-action@v5
      with:
        push: true
        tags: ${{ secrets.ACR_REGISTRY_LOGIN_SERVER_PW }}/aspcoresample:${{ github.sha }}
        file: /docker/asset_profiler/.
