# Global Parameters
#========================
  <system>
    suppress_config_dump true
  </system>

# Sources
#======================
  # Send Wazuh Data to S3 Bucket
  <source>
    @type tail
    path /var/ossec/logs/alerts/alerts.json
    pos_file /var/log/data/gluon/alerts.json.pos
    tag wazuh
    <parse>
      @type json
    </parse>
  </source>

  <match *>
    @type s3
    aws_key_id ""
    aws_sec_key ""
    s3_bucket s3-hids
    s3_region ap-south-1
    path ${tag}/
    <format>
      @type json
    </format>
    <buffer tag,time>
      @type file
      path /var/log/gluon/s3
      timekey 60 
      timekey_use_utc true # use utc
      chunk_limit_size 256m
    </buffer>
  </match>

# Send Wazuh Data to Development Opensearch

  <source>
    @type tail
    path /var/ossec/logs/alerts/alerts.json
    tag wazuh
    @label @processing-data
    <parse>
      @type json
    </parse>
  </source>

# Processing data into parted file
  <label @processing-data>
   # Outputs
   #=====================
     # Generating Alert partfiles.
    <match wazuh>
      @type file
      path /var/log/data/parted_data/wazuh/part-%Y-%m-%d-%H-%M
      add_path_suffix true
      path_suffix ".json"
      append true
      <format>
        @type json
      </format>
      <buffer>
        timekey 1m
        timekey_use_utc true
        timekey_wait 0s
        chunk_limit_size 200m
      </buffer>
    </match>
  </label>

  <source>
    @type tail
    path /var/log/data/processed_data/wazuh_event.json
    tag event
    @label @event-data
    <parse>
      @type json
    </parse>
  </source>
  <source>
    @type tail
    path /var/log/data/processed_data/wazuh_incident.json
    tag incident
    @label @incident-data
    <parse>
      @type json
    </parse>
  </source>
  <source>
    @type tail
    path /var/log/data/processed_data/wazuh_alert.json
    tag alert
    @label @alert-data
    <parse>
      @type json
    </parse>
  </source>
<label @event-data>
  <filter event>
    @type record_modifier
    <record>
      log_tag "xdr-hids-event-whi-whigur4386"
      agent_location "Whizhack-AWS"
    </record>
  </filter>
# Outputs
#=======================
#   Sending alerts to log aggregator.
  <match **>
    @type forward
    <server>
      host " " 
      port "24224"
    </server>
    compress gzip
    heartbeat_type none
    <buffer>
      @type memory
      flush_thread_count 5
      flush_interval 5s
      chunk_limit_size 256m
    </buffer>
  </match>
</label>
 
<label @alert-data>
  <filter alert>
    @type record_modifier
    <record>
      log_tag "xdr-hids-alert-whi-whigur4386"
      agent_location "Whizhack-AWS"
    </record>
  </filter>
# Outputs
#=======================
#   Sending alerts to log aggregator.
  <match **>
    @type forward
    <server>
      host " " # 
      port "24224"
    </server>
    compress gzip
    heartbeat_type none
    <buffer>
      @type memory
      flush_thread_count 5
      flush_interval 5s
      chunk_limit_size 256m
    </buffer>
  </match>
</label>
 
<label @incident-data>
  <filter incident>
    @type record_modifier
    <record>
      log_tag "xdr-hids-incident-whi-whigur4386"
      agent_location "Whizhack-AWS"
    </record>
  </filter>
# Outputs
#=======================
#   Sending alerts to log aggregator.
  <match *>
    @type forward
    <server>
      host " " #
      port "24224"
    </server>
    compress gzip
    heartbeat_type none
    <buffer>
      @type memory
      flush_thread_count 5
      flush_interval 5s
      chunk_limit_size 256m
    </buffer>
  </match>
</label>

# Sending logs to staging aggregator 

<source>
  @type tail
  path /var/log/data/processed_data/wazuh_event.json
  tag stag-event
  @label @stag-event-data
  <parse>
    @type json
  </parse>
</source>
<source>
  @type tail
  path /var/log/data/processed_data/wazuh_incident.json
  tag stag-incident
  @label @stag-incident-data
  <parse>
    @type json
  </parse>
</source>
<source>
  @type tail
  path /var/log/data/processed_data/wazuh_alert.json
  tag stag-alert
  @label @stag-alert-data
  <parse>
    @type json
  </parse>
</source>
  # Appending a identifier to the data for routing.
<label @stag-event-data>
  <filter stag-event>
    @type record_modifier
    <record>
      log_tag "xdr-hids-event-whi-whigur4386"
      agent_location "Whizhack-AWS"
    </record>
  </filter>
# Outputs
#=======================
#   Sending alerts to log aggregator.
  <match **>
    @type forward
    <server>
      host "20.219.121.45" # 
      port "24224"
    </server>
    compress gzip
    heartbeat_type none
    <buffer>
      @type memory
      flush_thread_count 5
      flush_interval 5s
      chunk_limit_size 256m
    </buffer>
  </match>
</label>
 
<label @stag-alert-data>
  <filter stag-alert>
    @type record_modifier
    <record>
      log_tag "xdr-hids-alert-whi-whigur4386"
      agent_location "Whizhack-AWS"
    </record>
  </filter>
# Outputs
#=======================
#   Sending alerts to log aggregator.
  <match **>
    @type forward
    <server>
      host "20.219.121.45" # 
      port "24224"
    </server>
    compress gzip
    heartbeat_type none
    <buffer>
      @type memory
      flush_thread_count 5
      flush_interval 5s
      chunk_limit_size 256m
    </buffer>
  </match>
</label>
 
<label @stag-incident-data>
  <filter stag-incident>
    @type record_modifier
    <record>
      log_tag "xdr-hids-incident-whi-whigur4386"
      agent_location "Whizhack-AWS"
    </record>
  </filter>
# Outputs
#=======================
#   Sending alerts to log aggregator.
  <match *>
    @type forward
    <server>
      host "20.219.121.45" #
      port "24224"
    </server>
    compress gzip
    heartbeat_type none
    <buffer>
      @type memory
      flush_thread_count 5
      flush_interval 5s
      chunk_limit_size 256m
    </buffer>
  </match>
</label>